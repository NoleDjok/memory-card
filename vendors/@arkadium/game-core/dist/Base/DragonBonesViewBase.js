"use strict";
/*!@license
 * Copyright (c) Arkadium Inc - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Denis Gusarov <denis.gusarov@arkadium.com>
 */var __extends=this&&this.__extends||function(){var r=function(t,i){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(t,i)};return function(t,i){function e(){this.constructor=t}r(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}}();Object.defineProperty(exports,"__esModule",{value:!0});var Linq_1=require("../Linq/Linq"),TextureList_1=require("./TextureList"),SpriteEvents_1=require("./SpriteEvents"),SpriteList_1=require("./SpriteList"),SlotList_1=require("./SlotList"),BoundingBoxList_1=require("./BoundingBoxList"),AnimationsList_1=require("./AnimationsList"),AnimationsEventsList_1=require("./AnimationsEventsList"),PixiFactory_1=require("../dragonBones/pixi4/PixiFactory"),_ViewBase_1=require("./_ViewBase"),DragonBonesViewBase=function(n){function o(t){var i=n.call(this,t)||this;return i.name=t,i._armature=null,i._armatureDisplay=null,i._armatureName=null,i.$textures=new TextureList_1.TextureList,i.$sprites=new SpriteList_1.SpriteList,i.$slots=new SlotList_1.SlotList,i.$boundingBoxes=new BoundingBoxList_1.BoundingBoxList,i.$spritesEvents=new SpriteEvents_1.SpriteEvents,i.$animations=new AnimationsList_1.AnimationsList,i.$animationsEvents=new AnimationsEventsList_1.AnimationsEventsList,i}return __extends(o,n),Object.defineProperty(o.prototype,"display",{get:function(){return this._armatureDisplay||null!=this._armature&&this._armature.display},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"x",{get:function(){return this._armatureDisplay.x},set:function(t){this._armatureDisplay.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"y",{get:function(){return this._armatureDisplay.y},set:function(t){this._armatureDisplay.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"rotation",{get:function(){return this._armatureDisplay.rotation},set:function(t){this._armatureDisplay.rotation=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"scaleX",{get:function(){return this._armatureDisplay.scale.x},set:function(t){this._armatureDisplay.scale.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"scaleY",{get:function(){return this._armatureDisplay.scale.y},set:function(t){this._armatureDisplay.scale.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"armatureDisplay",{get:function(){return this._armatureDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"alpha",{get:function(){return this._armatureDisplay.alpha},set:function(t){this._armatureDisplay.alpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"visible",{get:function(){return this._armatureDisplay.visible},set:function(t){null!=this._armatureDisplay&&null!=this._armatureDisplay&&(this._armatureDisplay.visible=t)},enumerable:!0,configurable:!0}),o.prototype.initialize=function(t,i){if(void 0===i&&(i=null),t instanceof o)if(this.parentContainer=t.display,this.config.slot){var e=t.armature.getSlot(this.config.slot);if(e||console.error(this.name+": error can't find slot '"+this.config.slot+"' in armature '"+t.armature.name+"'"),a=e.childArmature)this._armature=a,this._armatureDisplay=this._armature.display;else if(this.config.replace){var r=PixiFactory_1.PixiFactory.factory.buildArmatureDisplay(this.config.armatureName);e.replaceDisplay(r),e.displayIndex=0,this._armature=r.armature,this._armatureDisplay=r,this._parentArmature=t.armature}else{r=PixiFactory_1.PixiFactory.factory.buildArmatureDisplay(this.config.armatureName);this._armature=r.armature,e.display.addChild(r),this._armatureDisplay=r,this._parentArmature=t.armature}}else if(this.config.armatureName){var a;if((r=PixiFactory_1.PixiFactory.factory.buildArmatureDisplay(this.config.armatureName))||console.error("Armature '"+this.config.armatureName+"' build error"),!(a=r.armature))return void console.error("Armature '"+this.config.armatureName+"' build error");this._armature=a,this._armatureDisplay=this._armature.display,this.container=t.armature.display,this.container.addChild(this._armatureDisplay)}else this._armature=t.armature;else{this.parentContainer=i||t.display;var s=(r=PixiFactory_1.PixiFactory.factory.buildArmatureDisplay(this.config.armatureName)).armature;s&&(this._armatureMustDispose=!0,this._armature=s,this._armatureName=this.config.armatureName,this._armatureDisplay=this._armature.display,this._armatureSlots=new Linq_1.List(this._armature.getSlots()),this.container=this.parentContainer),this.parentContainer.addChild(this.display)}if(this._armature)return this.$boundingBoxes.initialize(this.config.boundingBoxes,this._armature),this.$sprites.initialize(this.config.sprites,this._armature,this),this.$slots.initialize(this.config.slots,this._armature),this.$spritesEvents.initialize(this.config.events,this.$boundingBoxes,this.$sprites,this,this.logger),this.$animations.initialize(this.config.animations,this._armature,this,this.logger),this.$animationsEvents.initialize(this.config.animationsEvents,this.$animations,this._armature,this,this.logger),n.prototype.initialize.call(this,t,i);console.error("View '"+this.constructor.name+"' can't load")},o.prototype.dispose=function(){if(n.prototype.dispose.call(this),this.$animationsEvents.dispose(),this.$spritesEvents.dispose(),this.container)this.container.removeChild(this._armatureDisplay),this._armature.dispose(),this._armature=null,this.container=null;else if(this._parentArmature){this._parentArmature.getSlot(this.config.slot).replaceDisplay(null)}},o.prototype.clear=function(){n.prototype.clear.call(this),this.$textures=new TextureList_1.TextureList,this.$sprites=new SpriteList_1.SpriteList,this.$slots=new SlotList_1.SlotList,this.$spritesEvents=new SpriteEvents_1.SpriteEvents,this.$animations=new AnimationsList_1.AnimationsList,this.$animationsEvents=new AnimationsEventsList_1.AnimationsEventsList},o}(_ViewBase_1._ViewBase),DragonBonesLoadingViewBase=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.toggleVisible=function(t){this.visible!=t&&((this.visible=t)?this.onShow():this.onHide())},i}(exports.DragonBonesViewBase=DragonBonesViewBase);exports.DragonBonesLoadingViewBase=DragonBonesLoadingViewBase;