"use strict";
/*!@license
 * Copyright (c) Arkadium Inc - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Denis Gusarov <denis.gusarov@arkadium.com>
 */var __decorate=this&&this.__decorate||function(e,t,n,o){var r,c=arguments.length,a=c<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var i=e.length-1;0<=i;i--)(r=e[i])&&(a=(c<3?r(a):3<c?r(t,n,a):r(t,n))||a);return 3<c&&a&&Object.defineProperty(t,n,a),a},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var Linq_1=require("../../Linq/Linq"),expandFunc_1=require("../expandFunc"),underscore_1=require("../../Utils/underscore"),GamePerformance_1=require("../../GamePerformance"),ModelWatchItem=function(){function e(e,t,r){this._event=e,this._viewName=t,this.disposed=!1;var c=this;this.event=function(e,t,n,o){c.disposed||n==c.name&&this==c.context&&(r.log(c._viewName,"ModelWatchEvent",c.name,t,"=>",e,c.context),c.run(e,t))}}return e.prototype.run=function(e,t){this._event(e,t)},__decorate([GamePerformance_1.GamePerformanceMethod("ModelWatchEvent","Model watch"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",void 0)],e.prototype,"run",null),e}();exports.ModelWatchItem=ModelWatchItem;var ModelWatchesList=function(){function e(e){this._watchObject=e,this.items=new Linq_1.List}return e.prototype.get=function(e){return this[e]},e.prototype.initialize=function(e,a,i,s){var u=this;underscore_1._u.each(e,function(e,t){if(null!=i&&null!=i){var n=expandFunc_1.expandFunc(e,a),o=new ModelWatchItem(n,a.locator,s),r=t.split(".");if(o.key=t,o.name=r[r.length-1],o.context=i,1<r.length)for(var c=0;c<r.length-1;c++){if(!o.context[r[c]])return void console.error(u.constructor.name+": 1. error can't find model property '"+r[c]+"' for '"+t+"'",o.context);o.context=o.context[r[c]]}null!=o.context[o.name]&&null!=o.context[o.name]?(u.items.Add(o),u[t]=o,u._watchObject.watch(o.context,o.name,o.event)):console.error(u.constructor.name+": 2. error can't find model property '"+o.name+"' for '"+t+"'",o.context)}else console.error(u.constructor.name+": error $model is null for property '"+t+"'")},this)},e.prototype.dispose=function(){var t=this;this.items.ForEach(function(e){e.disposed=!0,t._watchObject.unwatch(e.context,e.name,e.event)}),this._watchObject=null},e}();exports.ModelWatchesList=ModelWatchesList;