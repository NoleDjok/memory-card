"use strict";var __extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(exports,"__esModule",{value:!0});var BaseArenaApi_1=require("./BaseArenaApi"),ISoundManager_1=require("../Sound/ISoundManager"),AdStates=function(){function t(){}return t.UNLOADED="UNLOADED",t.LOADING="LOADING",t.LOADED="LOADED",t}();exports.AdStates=AdStates;var ArenaCocoonApi=function(i){function t(){var t=i.call(this)||this;return t._timeMsLastShowAdMs=0,t._timeMsIntervalShowAd=3e5,t._interstitialAdState=AdStates.UNLOADED,t._needStartMusic=!1,t._needStartSound=!1,t._pauseHandler=function(){t.handleMidrollStart()},t._resumeHandler=function(){t.handleMidrollFinish()},t}return __extends(t,i),t.prototype.getCurrentTimeUTCms=function(){return(new Date).getTime()},t.prototype.checkIntervalShowAd=function(){var t=!1;return this.getCurrentTimeUTCms()-this._timeMsLastShowAdMs>this._timeMsIntervalShowAd&&(t=!0),t},t.prototype.registerActions=function(t){window.ARK_game_arena_connector.init(),window.ARK_game_arena_connector.registerAction("pause",this._pauseHandler),window.ARK_game_arena_connector.registerAction("resume",this._resumeHandler),window.ARK_game_arena_connector.registerAction("test_action",t),window.ARK_game_arena_connector.initTestingEnvironment()},t.prototype.initializeABTest=function(t){},t.prototype.handleGameStart=function(){window.ARK_game_arena_connector.fireEventToArena("game_start")},t.prototype.handleEventChange=function(){window.ARK_game_arena_connector.fireEventToArena("event_change"),this.handleRefreshInterstitial()},t.prototype.changeScore=function(t){window.ARK_game_arena_connector.changeScore(t)},t.prototype.handleMidrollRequest=function(){window.ARK_game_arena_connector.fireEventToArena("pause_ready")},t.prototype.handleMidrollStart=function(){this._soundManager&&(this._soundManager.data.musicOn&&(this._needStartMusic=!0,this._soundManager.muteSoundsByType(!0,ISoundManager_1.SoundType.Music)),this._soundManager.data.soundOn&&(this._needStartSound=!0,this._soundManager.muteSoundsByType(!0,ISoundManager_1.SoundType.SFX)))},t.prototype.getArenaName=function(){return"Not Implemented"},t.prototype.setArenaName=function(t){},t.prototype.handleMidrollFinish=function(){this._soundManager&&(this._needStartMusic&&(this._needStartMusic=!1,this._soundManager.muteSoundsByType(!1,ISoundManager_1.SoundType.Music)),this._needStartSound&&(this._needStartSound=!1,this._soundManager.muteSoundsByType(!1,ISoundManager_1.SoundType.SFX)))},t.prototype.handleCustomEvent=function(t,e){window.ARK_game_arena_connector.fireEventToArena(t,e)},t.prototype.handleGameEnd=function(t){window.ARK_game_arena_connector.changeScore(t.score),window.ARK_game_arena_connector.fireEventToArena("game_end")},t.prototype.shouldShowInternalGameEnd=function(){return!0},t.prototype.absoluteURL=function(t){return t},t.prototype.getLocale=function(t,e){var n=window.navigator.language;return i.prototype.getLocale.call(this,t,e,n)},t.prototype.handleInitInterstitial=function(t){var e=this;window.Cocoon.Ad&&(window.Cocoon.Ad.Heyzap.configure({publisherId:t}),this._interstitialAd=window.Cocoon.Ad.Heyzap.createInterstitial(),null!=this._interstitialAd&&(this._interstitialAd.on("load",function(){e._interstitialAdState=AdStates.LOADED}.bind(this)),this._interstitialAd.on("show",function(){e.handleMidrollFinish()}.bind(this)),this._interstitialAd.on("fail",function(){e._interstitialAdState=AdStates.UNLOADED}.bind(this)),this._interstitialAd.on("dismiss",function(){e.handleMidrollFinish()}.bind(this)),this._interstitialAd.on("click",function(){}.bind(this))),this.handleLoadInterstitial())},t.prototype.handleLoadInterstitial=function(){null!=this._interstitialAd&&this._interstitialAdState!=AdStates.LOADED&&(this._interstitialAdState=AdStates.LOADING,this._interstitialAd.load())},t.prototype.handleShowInterstitial=function(){null!=this._interstitialAd&&(this.checkIntervalShowAd()&&this._interstitialAdState==AdStates.LOADED?(this._timeMsLastShowAdMs=this.getCurrentTimeUTCms(),this._interstitialAdState=AdStates.UNLOADED,this._interstitialAd.show(),this.handleMidrollStart()):this.handleLoadInterstitial())},t.prototype.handleRefreshInterstitial=function(){null!=this._interstitialAd&&this._interstitialAdState==AdStates.UNLOADED&&(this._interstitialAdState=AdStates.LOADING,this._interstitialAd.load())},t.prototype.setSoundManager=function(t){this._soundManager=t},t.prototype.getPlatform=function(){return window.Cocoon.getPlatform()},t.prototype.rewardAvailable=function(){return!1},t.prototype.showReward=function(t){t(!1)},t.prototype.getParam=function(t,e){return e},t.prototype.getGameConfigUrl=function(){return""},t}(BaseArenaApi_1.BaseArenaApi);exports.ArenaCocoonApi=ArenaCocoonApi;