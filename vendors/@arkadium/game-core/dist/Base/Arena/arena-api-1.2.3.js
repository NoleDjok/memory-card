"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ARK_game_arena_connector={_actionHandler:{},_showGameEnd:!0,_scoreChangleLog:[],_score:0,_playId:"",_gameSecret:"",_params:[],_arena_events_subscription:{},_arena_return_values_subscription:{},_TRUE_AS_STRING:String(!0).toLowerCase(),_messageSender:null,_postInitCallback:null,_md5:function(e){function c(e,n){return e<<n|e>>>32-n}function g(e,n){var r,a,o,t,_;return o=2147483648&e,t=2147483648&n,_=(1073741823&e)+(1073741823&n),(r=1073741824&e)&(a=1073741824&n)?2147483648^_^o^t:r|a?1073741824&_?3221225472^_^o^t:1073741824^_^o^t:_^o^t}function n(e,n,r,a,o,t,_){var s;return g(c(e=g(e,g(g((s=n)&r|~s&a,o),_)),t),n)}function r(e,n,r,a,o,t,_){var s;return g(c(e=g(e,g(g(n&(s=a)|r&~s,o),_)),t),n)}function a(e,n,r,a,o,t,_){return g(c(e=g(e,g(g(n^r^a,o),_)),t),n)}function o(e,n,r,a,o,t,_){return g(c(e=g(e,g(g(r^(n|~a),o),_)),t),n)}function t(e){var n,r="",a="";for(n=0;n<=3;n++)r+=(a="0"+(e>>>8*n&255).toString(16)).substr(a.length-2,2);return r}var _,s,m,i,p,l,u,d,f,A=Array();for(A=function(e){for(var n,r=e.length,a=r+8,o=16*((a-a%64)/64+1),t=Array(o-1),_=0,s=0;s<r;)_=s%4*8,t[n=(s-s%4)/4]=t[n]|e.charCodeAt(s)<<_,s++;return _=s%4*8,t[n=(s-s%4)/4]=t[n]|128<<_,t[o-2]=r<<3,t[o-1]=r>>>29,t}(e=function(e){e=e.replace(/\r\n/g,"\n");for(var n="",r=0;r<e.length;r++){var a=e.charCodeAt(r);a<128?n+=String.fromCharCode(a):(127<a&&a<2048?n+=String.fromCharCode(a>>6|192):(n+=String.fromCharCode(a>>12|224),n+=String.fromCharCode(a>>6&63|128)),n+=String.fromCharCode(63&a|128))}return n}(e)),l=1732584193,u=4023233417,d=2562383102,f=271733878,_=0;_<A.length;_+=16)u=o(u=o(u=o(u=o(u=a(u=a(u=a(u=a(u=r(u=r(u=r(u=r(u=n(u=n(u=n(u=n(m=u,d=n(i=d,f=n(p=f,l=n(s=l,u,d,f,A[_+0],7,3614090360),u,d,A[_+1],12,3905402710),l,u,A[_+2],17,606105819),f,l,A[_+3],22,3250441966),d=n(d,f=n(f,l=n(l,u,d,f,A[_+4],7,4118548399),u,d,A[_+5],12,1200080426),l,u,A[_+6],17,2821735955),f,l,A[_+7],22,4249261313),d=n(d,f=n(f,l=n(l,u,d,f,A[_+8],7,1770035416),u,d,A[_+9],12,2336552879),l,u,A[_+10],17,4294925233),f,l,A[_+11],22,2304563134),d=n(d,f=n(f,l=n(l,u,d,f,A[_+12],7,1804603682),u,d,A[_+13],12,4254626195),l,u,A[_+14],17,2792965006),f,l,A[_+15],22,1236535329),d=r(d,f=r(f,l=r(l,u,d,f,A[_+1],5,4129170786),u,d,A[_+6],9,3225465664),l,u,A[_+11],14,643717713),f,l,A[_+0],20,3921069994),d=r(d,f=r(f,l=r(l,u,d,f,A[_+5],5,3593408605),u,d,A[_+10],9,38016083),l,u,A[_+15],14,3634488961),f,l,A[_+4],20,3889429448),d=r(d,f=r(f,l=r(l,u,d,f,A[_+9],5,568446438),u,d,A[_+14],9,3275163606),l,u,A[_+3],14,4107603335),f,l,A[_+8],20,1163531501),d=r(d,f=r(f,l=r(l,u,d,f,A[_+13],5,2850285829),u,d,A[_+2],9,4243563512),l,u,A[_+7],14,1735328473),f,l,A[_+12],20,2368359562),d=a(d,f=a(f,l=a(l,u,d,f,A[_+5],4,4294588738),u,d,A[_+8],11,2272392833),l,u,A[_+11],16,1839030562),f,l,A[_+14],23,4259657740),d=a(d,f=a(f,l=a(l,u,d,f,A[_+1],4,2763975236),u,d,A[_+4],11,1272893353),l,u,A[_+7],16,4139469664),f,l,A[_+10],23,3200236656),d=a(d,f=a(f,l=a(l,u,d,f,A[_+13],4,681279174),u,d,A[_+0],11,3936430074),l,u,A[_+3],16,3572445317),f,l,A[_+6],23,76029189),d=a(d,f=a(f,l=a(l,u,d,f,A[_+9],4,3654602809),u,d,A[_+12],11,3873151461),l,u,A[_+15],16,530742520),f,l,A[_+2],23,3299628645),d=o(d,f=o(f,l=o(l,u,d,f,A[_+0],6,4096336452),u,d,A[_+7],10,1126891415),l,u,A[_+14],15,2878612391),f,l,A[_+5],21,4237533241),d=o(d,f=o(f,l=o(l,u,d,f,A[_+12],6,1700485571),u,d,A[_+3],10,2399980690),l,u,A[_+10],15,4293915773),f,l,A[_+1],21,2240044497),d=o(d,f=o(f,l=o(l,u,d,f,A[_+8],6,1873313359),u,d,A[_+15],10,4264355552),l,u,A[_+6],15,2734768916),f,l,A[_+13],21,1309151649),d=o(d,f=o(f,l=o(l,u,d,f,A[_+4],6,4149444226),u,d,A[_+11],10,3174756917),l,u,A[_+2],15,718787259),f,l,A[_+9],21,3951481745),l=g(l,s),u=g(u,m),d=g(d,i),f=g(f,p);return(t(l)+t(u)+t(d)+t(f)).toLowerCase()},_urlEncode:function(){for(var e="",n=arguments,r=0;r<n.length;r++){var a=n[r].key,o=n[r].value;e+=a+"=";for(var t=0;t<o.length;t++)e+=o[t],t<o.length-1&&(e+=",");r<n.length-1&&(e+="&")}return e},_urlDecode:function(e){return decodeURIComponent((e+"").replace(/\+/g,"%20"))},_parseMessage:function(e){var n={empty:!0,events:[],actions:[],params:exports.ARK_game_arena_connector._params,returnValues:[],show_game_end:exports.ARK_game_arena_connector._showGameEnd,play_id:exports.ARK_game_arena_connector._playId};if("string"!=typeof e)return n;for(var r=e.split("&"),a=0;a<r.length;a++){var o=r[a].split("=");if(2===o.length){var t=o[0];"action"===t&&(t="actions");var _=decodeURIComponent(o[1]),s=_.split(",");if("events"===t||"actions"===t)n[t]=s,n.empty=!1;else if("get_values"===t)n.returnValues=s,n.empty=!1;else if("play_id"===t)n[t]=_,n.empty=!1;else if("show_game_end"===t)n[t]=_===exports.ARK_game_arena_connector._TRUE_AS_STRING,n.empty=!1;else if(0<s.length)for(var c=!(n.empty=!1),g=0;g<s.length;g++){for(var m=0;m<n.params.length;++m)if(n.params[m].name===t){n.params[m].value=decodeURIComponent(s[g]),c=!1;break}c&&n.params.push({name:t,value:decodeURIComponent(s[g])})}}}return n},registerAction:function(e,n){exports.ARK_game_arena_connector._actionHandler[e]=n},fireEventToArena:function(e,n){if(!0===exports.ARK_game_arena_connector._arena_events_subscription[e]||"event_change"===e||"test_ready"===e){var r="event="+e;if("game_end"===e)for(var a in r+="&score="+encodeURIComponent(exports.ARK_game_arena_connector._score.toString())+"&score_hash="+exports.ARK_game_arena_connector._md5(exports.ARK_game_arena_connector._score.toString()+"_"+exports.ARK_game_arena_connector._playId+"_"+exports.ARK_game_arena_connector._gameSecret),exports.ARK_game_arena_connector._arena_return_values_subscription)"game_log"===a&&!0===exports.ARK_game_arena_connector._arena_return_values_subscription[a]&&(r+="&game_log="+encodeURIComponent(JSON.stringify(exports.ARK_game_arena_connector._scoreChangleLog)));else n&&0<n.length&&(r+="&"+n);try{exports.ARK_game_arena_connector._messageSender(r,"*")}catch(e){}}},showGameEnd:function(){return exports.ARK_game_arena_connector._showGameEnd},changeScore:function(e,n){exports.ARK_game_arena_connector._score=e,exports.ARK_game_arena_connector._scoreChangleLog.push({score:e,time:(new Date).getTime(),comment:n})},setGameSecret:function(e){exports.ARK_game_arena_connector._gameSecret=e},_handleMessageFromArena:function(e){exports.ARK_game_arena_connector.doInit(e.data)},_iframe_messageSender:function(e){parent.postMessage(e,"*")},_arkPage_messageSender:function(e){arkPage.postMessage(e)},getParam:function(e,n){for(var r=0;r<exports.ARK_game_arena_connector._params.length;++r)if(exports.ARK_game_arena_connector._params[r].name===e)return exports.ARK_game_arena_connector._params[r].value;return n},init:function(e,n){var r;(exports.ARK_game_arena_connector._postInitCallback="function"==typeof e?e:null,"arkPage"in window&&null!=arkPage.postMessage)?(exports.ARK_game_arena_connector._messageSender=exports.ARK_game_arena_connector._arkPage_messageSender,exports.ARK_game_arena_connector._arkPage_messageSender("event=game_loaded&callback=ARK_game_arena_connector.doInit")):(exports.ARK_game_arena_connector._messageSender=exports.ARK_game_arena_connector._iframe_messageSender,window.addEventListener?window.addEventListener("message",exports.ARK_game_arena_connector._handleMessageFromArena,!1):window.attachEvent("onmessage",exports.ARK_game_arena_connector._handleMessageFromArena),r=n?"".concat(window.location.search.substr(1),"&",n):window.location.search.substr(1),exports.ARK_game_arena_connector.doInit(r))},doInit:function(e){var n,r,a=exports.ARK_game_arena_connector._parseMessage(e);if(a.empty)null!==exports.ARK_game_arena_connector._postInitCallback&&(exports.ARK_game_arena_connector._postInitCallback(),exports.ARK_game_arena_connector._postInitCallback=null);else{for(exports.ARK_game_arena_connector._showGameEnd=a.show_game_end,exports.ARK_game_arena_connector._playId=a.play_id,exports.ARK_game_arena_connector._params=a.params,r=0;r<a.actions.length;++r)"function"==typeof(n=exports.ARK_game_arena_connector._actionHandler[a.actions[r]])&&n(a.params);var o="";for(r=0;r<a.returnValues.length;++r)exports.ARK_game_arena_connector._arena_return_values_subscription[a.returnValues[r]]=!0,"score"===a.returnValues[r]&&(o+="score="+encodeURIComponent(exports.ARK_game_arena_connector._score.toString())),"score_hash"===a.returnValues[r]&&(o+="&score_hash="+exports.ARK_game_arena_connector._md5(exports.ARK_game_arena_connector._score.toString()+"_"+exports.ARK_game_arena_connector._playId)),"game_log"===a.returnValues[r]&&(o+="&game_log="+encodeURIComponent(JSON.stringify(exports.ARK_game_arena_connector._scoreChangleLog)));for(r=0;r<a.events.length;++r)exports.ARK_game_arena_connector._arena_events_subscription[a.events[r]]=!0;0<o.length&&exports.ARK_game_arena_connector._messageSender(o),null!==exports.ARK_game_arena_connector._postInitCallback&&(exports.ARK_game_arena_connector._postInitCallback(),exports.ARK_game_arena_connector._postInitCallback=null)}},initTestingEnvironment:function(){exports.ARK_game_arena_connector.fireEventToArena("test_ready")}};