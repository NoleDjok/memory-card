"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Howler1=function(){var i={},m=null,r=!0,u=!1;try{"undefined"!=typeof AudioContext?m=new AudioContext:"undefined"!=typeof webkitAudioContext?m=new webkitAudioContext:r=!1}catch(e){r=!1}if(!r)if("undefined"!=typeof Audio)try{new Audio}catch(e){u=!0}else u=!0;if(r){var a=void 0===m.createGain?m.createGainNode():m.createGain();a.gain.value=1,a.connect(m.destination)}var d=function(e){this._volume=1,this._muted=!1,this.usingWebAudio=r,this.ctx=m,this.noAudio=u,this._howls=[],this._codecs=e,this.iOSAutoEnable=!0};d.prototype={volume:function(e){var o=this;if(0<=(e=parseFloat(e))&&e<=1){for(var n in o._volume=e,r&&(a.gain.value=e),o._howls)if(o._howls.hasOwnProperty(n)&&!1===o._howls[n]._webAudio)for(var t=0;t<o._howls[n]._audioNode.length;t++)o._howls[n]._audioNode[t].volume=o._howls[n]._volume*o._volume;return o}return r?a.gain.value:o._volume},mute:function(){return this._setMuted(!0),this},unmute:function(){return this._setMuted(!1),this},_setMuted:function(e){var o=this;for(var n in o._muted=e,r&&(a.gain.value=e?0:o._volume),o._howls)if(o._howls.hasOwnProperty(n)&&!1===o._howls[n]._webAudio)for(var t=0;t<o._howls[n]._audioNode.length;t++)o._howls[n]._audioNode[t].muted=e},codecs:function(e){return this._codecs[e]},_enableiOSAudio:function(){var n=this;if(!m||!n._iOSEnabled&&/iPhone|iPad|iPod/i.test(navigator.userAgent)){n._iOSEnabled=!1;var t=function(){var e=m.createBuffer(1,1,22050),o=m.createBufferSource();o.buffer=e,o.connect(m.destination),void 0===o.start?o.noteOn(0):o.start(0),setTimeout(function(){o.playbackState!==o.PLAYING_STATE&&o.playbackState!==o.FINISHED_STATE||(n._iOSEnabled=!0,n.iOSAutoEnable=!1,window.removeEventListener("touchend",t,!1))},0)};return window.addEventListener("touchend",t,!1),n}}};var e=null,l={};u||(e=new Audio,l={mp3:!!e.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")});var y=new d(l),o=function(e){var o=this;o._autoplay=e.autoplay||!1,o._buffer=e.buffer||!1,o._duration=e.duration||0,o._format=e.format||null,o._loop=e.loop||!1,o._loaded=!1,o._sprite=e.sprite||{},o._src=e.src||"",o._pos3d=e.pos3d||[0,0,-.5],o._volume=void 0!==e.volume?e.volume:1,o._urls=e.urls||[],o._rate=e.rate||1,o._model=e.model||null,o._onload=[e.onload||function(){}],o._onloaderror=[e.onloaderror||function(){}],o._onend=[e.onend||function(){}],o._onpause=[e.onpause||function(){}],o._onplay=[e.onplay||function(){}],o._onendTimer=[],o._webAudio=r&&!o._buffer,o._audioNode=[],o._webAudio&&o._setupAudioNode(),void 0!==m&&m&&y.iOSAutoEnable&&y._enableiOSAudio(),y._howls.push(o),o.load()};if(o.prototype={load:function(){var e=this,o=null;if(u)e.on("loaderror",new Error("No audio support."));else{for(var n=0;n<e._urls.length;n++){var t,r;if(e._format)t=e._format;else{if(r=e._urls[n],(t=/^data:audio\/([^;,]+);/i.exec(r))||(t=/\.([^.]+)$/.exec(r.split("?",1)[0])),!t)return void e.on("loaderror",new Error("Could not extract format from passed URLs, please add format parameter."));t=t[1].toLowerCase()}if(l[t]){o=e._urls[n];break}}if(o){if(e._src=o,e._webAudio)s(e,o);else{var a=new Audio;a.addEventListener("error",function(){a.error&&4===a.error.code&&(d.noAudio=!0),e.on("loaderror",{type:a.error?a.error.code:0})},!1),e._audioNode.push(a),a.src=o,a._pos=0,a.preload="auto",a.volume=y._muted?0:e._volume*y.volume();var i=function(){e._duration=Math.ceil(10*a.duration)/10,0===Object.getOwnPropertyNames(e._sprite).length&&(e._sprite={_default:[0,1e3*e._duration]}),e._loaded||(e._loaded=!0,e.on("load")),e._autoplay&&e.play(),a.removeEventListener("canplaythrough",i,!1)};a.addEventListener("canplaythrough",i,!1),a.load()}return e}e.on("loaderror",new Error("No codec support for selected audio sources."))}},urls:function(e){var o=this;return e?(o.stop(),o._urls="string"==typeof e?[e]:e,o._loaded=!1,o.load(),o):o._urls},play:function(p,v){var h=this;return"function"==typeof p&&(v=p),p&&"function"!=typeof p||(p="_default"),h._loaded?h._sprite[p]?h._inactiveNode(function(e){e._sprite=p;var o=0<e._pos?e._pos:h._sprite[p][0]/1e3,n=0;h._webAudio?(n=h._sprite[p][1]/1e3-e._pos,0<e._pos&&(o=h._sprite[p][0]/1e3+o)):n=h._sprite[p][1]/1e3-(o-h._sprite[p][0]/1e3);var t,r,a,i,u,d,l,s=!(!h._loop&&!h._sprite[p][2]),_="string"==typeof v?v:Math.round(Date.now()*Math.random())+"";if(r={id:_,sprite:p,loop:s},t=setTimeout(function(){var e=!(!h._loop&&!h._sprite[p][2]);!h._webAudio&&e&&h.stop(r.id).play(p,r.id),h._webAudio&&!e&&(h._nodeById(r.id).paused=!0,h._nodeById(r.id)._pos=0,h._clearEndTimer(r.id)),h._webAudio||e||h.stop(r.id),h.on("end",_)},n/h._rate*1e3),h._onendTimer.push({timer:t,id:r.id}),h._webAudio){var f=h._sprite[p][0]/1e3,c=h._sprite[p][1]/1e3;e.id=_,e.paused=!1,b(h,[s,f,c],_),h._playStart=m.currentTime,e.gain.value=h._volume,void 0===e.bufferSource.start?s?e.bufferSource.noteGrainOn(0,o,86400):e.bufferSource.noteGrainOn(0,o,n):s?e.bufferSource.start(0,o,86400):e.bufferSource.start(0,o,n)}else{if(4!==e.readyState)return h._clearEndTimer(_),a=h,i=p,u=v,l=function(){a.play(i,u),d.removeEventListener("canplaythrough",l,!1)},(d=e).addEventListener("canplaythrough",l,!1),h;e.id=_,e.currentTime=o,e.muted=y._muted||e.muted,e.volume=h._volume*y.volume(),setTimeout(function(){e.play()},0)}return h.on("play"),"function"==typeof v&&v(_),h}):"function"==typeof v&&v():h.on("load",function(){h.play(p,v)}),h},pause:function(e){var o=this;if(!o._loaded)return o.on("play",function(){o.pause(e)}),o;o._clearEndTimer(e);var n=e?o._nodeById(e):o._activeNode();if(n)if(n._pos=o.pos(null,e),o._webAudio){if(!n.bufferSource||n.paused)return o;n.paused=!0,void 0===n.bufferSource.stop?n.bufferSource.noteOff(0):n.bufferSource.stop(0)}else n.pause();return o.on("pause"),o},stop:function(e){var o=this;if(!o._loaded)return o.on("play",function(){o.stop(e)}),o;o._clearEndTimer(e);var n=e?o._nodeById(e):o._activeNode();if(n)if(n._pos=0,o._webAudio){if(!n.bufferSource||n.paused)return o;n.paused=!0,void 0===n.bufferSource.stop?n.bufferSource.noteOff(0):n.bufferSource.stop(0)}else isNaN(n.duration)||(n.pause(),n.currentTime=0);return o},mute:function(e){var o=this;if(!o._loaded)return o.on("play",function(){o.mute(e)}),o;var n=o._activeNode();return n&&(o._webAudio?n.gain.value=0:n.muted=e),o},playing:function(e){var o=this._activeNode();return null!=o&&!o.paused},unmute:function(e){var o=this;if(!o._loaded)return o.on("play",function(){o.unmute(e)}),o;var n=e?o._nodeById(e):o._activeNode();return n&&(o._webAudio?n.gain.value=o._volume:n.muted=!1),o},volume:function(e,o){var n=this;if(0<=(e=parseFloat(e))&&e<=1){if(n._volume=e,!n._loaded)return n.on("play",function(){n.volume(e,o)}),n;var t=o?n._nodeById(o):n._activeNode();return t&&(n._webAudio?t.gain.value=e:t.volume=e*y.volume()),n}return n._volume},loop:function(e){return"boolean"==typeof e?(this._loop=e,this):this._loop},sprite:function(e){return"object"==typeof e?(this._sprite=e,this):this._sprite},pos:function(e,o){var n=this;if(!n._loaded)return n.on("load",function(){n.pos(e)}),"number"==typeof e?n:n._pos||0;e=parseFloat(e);var t=o?n._nodeById(o):n._activeNode();if(t)return 0<=e?(n.pause(o),t._pos=e,n.play(t._sprite,o),n):n._webAudio?t._pos+(m.currentTime-n._playStart):t.currentTime;if(0<=e)return n;for(var r=0;r<n._audioNode.length;r++)if(n._audioNode[r].paused&&4===n._audioNode[r].readyState)return n._webAudio?n._audioNode[r]._pos:n._audioNode[r].currentTime},pos3d:function(e,o,n,t){var r=this;if(o=void 0!==o&&o?o:0,n=void 0!==n&&n?n:-.5,!r._loaded)return r.on("play",function(){r.pos3d(e,o,n,t)}),r;if(!(0<=e||e<0))return r._pos3d;if(r._webAudio){var a=t?r._nodeById(t):r._activeNode();a&&(r._pos3d=[e,o,n],a.panner.setPosition(e,o,n),a.panner.panningModel=r._model||"HRTF")}return r},fade:function(e,t,o,r,a){var i=this,n=Math.abs(e-t),u=t<e?"down":"up",d=n/.01,l=o/d;if(!i._loaded)return i.on("load",function(){i.fade(e,t,o,r,a)}),i;i.volume(e,a);for(var s=1;s<=d;s++)!function(){var e=i._volume+("up"===u?.01:-.01)*s,o=Math.round(1e3*e)/1e3,n=t;setTimeout(function(){i.volume(o,a),o===n&&r&&r()},l*s)}()},fadeIn:function(e,o,n){return this.volume(0).play().fade(0,e,o,n)},fadeOut:function(e,o,n,t){var r=this;return r.fade(r._volume,e,o,function(){n&&n(),r.pause(t),r.on("end")},t)},_nodeById:function(e){for(var o=this._audioNode[0],n=0;n<this._audioNode.length;n++)if(this._audioNode[n].id===e){o=this._audioNode[n];break}return o},_activeNode:function(){for(var e=null,o=0;o<this._audioNode.length;o++)if(!this._audioNode[o].paused){e=this._audioNode[o];break}return this._drainPool(),e},_inactiveNode:function(e){for(var o,n=this,t=null,r=0;r<n._audioNode.length;r++)if(n._audioNode[r].paused&&4===n._audioNode[r].readyState){e(n._audioNode[r]),t=!0;break}if(n._drainPool(),!t)if(n._webAudio)o=n._setupAudioNode(),e(o);else{n.load(),o=n._audioNode[n._audioNode.length-1];var a=navigator.isCocoonJS?"canplaythrough":"loadedmetadata",i=function(){o.removeEventListener(a,i,!1),e(o)};o.addEventListener(a,i,!1)}},_drainPool:function(){var e,o=this,n=0;for(e=0;e<o._audioNode.length;e++)o._audioNode[e].paused&&n++;for(e=o._audioNode.length-1;0<=e&&!(n<=5);e--)o._audioNode[e].paused&&(o._webAudio&&o._audioNode[e].disconnect(0),n--,o._audioNode.splice(e,1))},_clearEndTimer:function(e){for(var o=-1,n=0;n<this._onendTimer.length;n++)if(this._onendTimer[n].id===e){o=n;break}var t=this._onendTimer[o];t&&(clearTimeout(t.timer),this._onendTimer.splice(o,1))},_setupAudioNode:function(){var e=this,o=e._audioNode,n=e._audioNode.length;return o[n]=void 0===m.createGain?m.createGainNode():m.createGain(),o[n].gain.value=e._volume,o[n].paused=!0,o[n]._pos=0,o[n].readyState=4,o[n].connect(a),o[n].panner=m.createPanner(),o[n].panner.panningModel=e._model||"equalpower",o[n].panner.setPosition(e._pos3d[0],e._pos3d[1],e._pos3d[2]),o[n].panner.connect(o[n]),o[n]},on:function(e,o){var n=this["_on"+e];if("function"==typeof o)n.push(o);else for(var t=0;t<n.length;t++)o?n[t].call(this,o):n[t].call(this);return this},off:function(e,o){var n=this["_on"+e];if(o){for(var t=0;t<n.length;t++)if(o===n[t]){n.splice(t,1);break}}else this["_on"+e]=[];return this},unload:function(){for(var e=this,o=e._audioNode,n=0;n<e._audioNode.length;n++)o[n].paused||(e.stop(o[n].id),e.on("end",o[n].id)),e._webAudio?o[n].disconnect(0):o[n].src="";for(n=0;n<e._onendTimer.length;n++)clearTimeout(e._onendTimer[n].timer);var t=y._howls.indexOf(e);null!==t&&0<=t&&y._howls.splice(t,1),delete i[e._src],e=null}},r)var s=function(e,o){if(o in i)return e._duration=i[o].duration,void f(e);if(/^data:[^;]+;base64,/.test(o)){for(var n=atob(o.split(",")[1]),t=new Uint8Array(n.length),r=0;r<n.length;++r)t[r]=n.charCodeAt(r);_(t.buffer,e,o)}else{var a=new XMLHttpRequest;a.open("GET",o,!0),a.responseType="arraybuffer",a.onload=function(){_(a.response,e,o)},a.onerror=function(){e._webAudio&&(e._buffer=!0,e._webAudio=!1,e._audioNode=[],delete e._gainNode,delete i[o],e.load())};try{a.send()}catch(e){a.onerror()}}},_=function(e,o,n){m.decodeAudioData(e,function(e){e&&(i[n]=e,f(o,e))},function(e){o.on("loaderror",e)})},f=function(e,o){e._duration=o?o.duration:e._duration,0===Object.getOwnPropertyNames(e._sprite).length&&(e._sprite={_default:[0,1e3*e._duration]}),e._loaded||(e._loaded=!0,e.on("load")),e._autoplay&&e.play()},b=function(e,o,n){var t=e._nodeById(n);t.bufferSource=m.createBufferSource(),t.bufferSource.buffer=i[e._src],t.bufferSource.connect(t.panner),t.bufferSource.loop=o[0],o[0]&&(t.bufferSource.loopStart=o[1],t.bufferSource.loopEnd=o[1]+o[2]),t.bufferSource.playbackRate.value=e._rate};return{Howler:y,Howl:o}};