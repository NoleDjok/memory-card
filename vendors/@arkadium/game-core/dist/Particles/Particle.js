"use strict";var __extends=this&&this.__extends||function(){var s=function(t,i){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(t,i)};return function(t,i){function e(){this.constructor=t}s(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}}();Object.defineProperty(exports,"__esModule",{value:!0});var ParticleUtils_1=require("./ParticleUtils"),PropertyList_1=require("./PropertyList"),Particle=function(e){function s(t){var i=e.call(this)||this;return i.emitter=t,i.anchor.x=i.anchor.y=.5,i.velocity=new PIXI.Point,i.rotationSpeed=0,i.rotationAcceleration=0,i.maxLife=0,i.age=0,i.ease=null,i.extraData=null,i.alphaList=new PropertyList_1.PropertyList,i.speedList=new PropertyList_1.PropertyList,i.speedMultiplier=1,i.acceleration=new PIXI.Point,i.maxSpeed=NaN,i.scaleList=new PropertyList_1.PropertyList,i.scaleMultiplier=1,i.colorList=new PropertyList_1.PropertyList(!0),i._doAlpha=!1,i._doScale=!1,i._doSpeed=!1,i._doAcceleration=!1,i._doColor=!1,i._doNormalMovement=!1,i._oneOverLife=0,i.next=null,i.prev=null,i.init=i.init,i.Particle_init=s.prototype.init,i.update=i.update,i.Particle_update=s.prototype.update,i.Sprite_destroy=e.prototype.destroy,i.Particle_destroy=s.prototype.destroy,i.applyArt=i.applyArt,i.kill=i.kill,i}return __extends(s,e),s.prototype.init=function(){this.age=0,this.velocity.x=this.speedList.current.value*this.speedMultiplier,this.velocity.y=0,ParticleUtils_1.ParticleUtils.rotatePoint(this.rotation,this.velocity),this.noRotation?this.rotation=0:this.rotation*=ParticleUtils_1.ParticleUtils.DEG_TO_RADS,this.rotationSpeed*=ParticleUtils_1.ParticleUtils.DEG_TO_RADS,this.rotationAcceleration*=ParticleUtils_1.ParticleUtils.DEG_TO_RADS,this.alpha=this.alphaList.current.value,this.scale.x=this.scale.y=this.scaleList.current.value,this._doAlpha=!!this.alphaList.current.next,this._doSpeed=!!this.speedList.current.next,this._doScale=!!this.scaleList.current.next,this._doColor=!!this.colorList.current.next,this._doAcceleration=0!==this.acceleration.x||0!==this.acceleration.y,this._doNormalMovement=this._doSpeed||0!==this.speedList.current.value||this._doAcceleration,this._oneOverLife=1/this.maxLife;var t=this.colorList.current.value;this.tint=ParticleUtils_1.ParticleUtils.combineRGBComponents(t.r,t.g,t.b),this.visible=!0},s.prototype.applyArt=function(t){this.texture=t||PIXI.Texture.EMPTY},s.prototype.update=function(t){if(this.age+=t,this.age>=this.maxLife||this.age<0)return this.kill(),-1;var i=this.age*this._oneOverLife;if(this.ease&&(i=4==this.ease.length?this.ease(i,0,1,1):this.ease(i)),this._doAlpha&&(this.alpha=this.alphaList.interpolate(i)),this._doScale){var e=this.scaleList.interpolate(i)*this.scaleMultiplier;this.scale.x=this.scale.y=e}if(this._doNormalMovement){var s=void 0,r=void 0;if(this._doSpeed){var o=this.speedList.interpolate(i)*this.speedMultiplier;ParticleUtils_1.ParticleUtils.normalize(this.velocity),ParticleUtils_1.ParticleUtils.scaleBy(this.velocity,o),s=this.velocity.x*t,r=this.velocity.y*t}else if(this._doAcceleration){var a=this.velocity.x,l=this.velocity.y;if(this.velocity.x+=this.acceleration.x*t,this.velocity.y+=this.acceleration.y*t,this.maxSpeed){var n=ParticleUtils_1.ParticleUtils.length(this.velocity);n>this.maxSpeed&&ParticleUtils_1.ParticleUtils.scaleBy(this.velocity,this.maxSpeed/n)}s=(a+this.velocity.x)/2*t,r=(l+this.velocity.y)/2*t}else s=this.velocity.x*t,r=this.velocity.y*t;this.position.x+=s,this.position.y+=r}if(this._doColor&&(this.tint=this.colorList.interpolate(i)),0!==this.rotationAcceleration){var c=this.rotationSpeed+this.rotationAcceleration*t;this.rotation+=(this.rotationSpeed+c)/2*t,this.rotationSpeed=c}else 0!==this.rotationSpeed?this.rotation+=this.rotationSpeed*t:this.acceleration&&!this.noRotation&&(this.rotation=Math.atan2(this.velocity.y,this.velocity.x));return i},s.prototype.kill=function(){this.emitter.recycle(this)},s.prototype.destroy=function(){this.parent&&this.parent.removeChild(this),this._texture&&this.Sprite_destroy(),this.emitter=this.velocity=this.colorList=this.scaleList=this.alphaList=this.speedList=this.ease=this.next=this.prev=null},s.parseArt=function(t){var i;for(i=t.length;0<=i;--i)"string"==typeof t[i]&&(t[i]=ParticleUtils_1.GetTextureFromString(t[i]));if(ParticleUtils_1.ParticleUtils.verbose)for(i=t.length-1;0<i;--i)if(t[i].baseTexture!=t[i-1].baseTexture){window.console&&console.warn("PixiParticles: using particle textures from different images may hinder performance in WebGL");break}return t},s.parseData=function(t){return t},s}(PIXI.Sprite);exports.Particle=Particle;