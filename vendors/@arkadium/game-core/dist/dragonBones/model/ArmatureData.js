"use strict";var __extends=this&&this.__extends||function(){var s=function(t,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)};return function(t,n){function e(){this.constructor=t}s(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}();Object.defineProperty(exports,"__esModule",{value:!0});var BaseObject_1=require("../core/BaseObject"),ColorTransform_1=require("../geom/ColorTransform"),DisplayData_1=require("./DisplayData"),Transform_1=require("../geom/Transform"),Rectangle_1=require("../geom/Rectangle"),ArmatureData=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.aabb=new Rectangle_1.Rectangle,t.animationNames=[],t.sortedBones=[],t.sortedSlots=[],t.defaultActions=[],t.actions=[],t.bones={},t.slots={},t.constraints={},t.skins={},t.animations={},t.canvas=null,t.userData=null,t}return __extends(t,n),t.toString=function(){return"[class dragonBones.ArmatureData]"},t.prototype._onClear=function(){for(var t=0,n=this.defaultActions;t<n.length;t++){n[t].returnToPool()}for(var e=0,s=this.actions;e<s.length;e++){s[e].returnToPool()}for(var o in this.bones)this.bones[o].returnToPool(),delete this.bones[o];for(var o in this.slots)this.slots[o].returnToPool(),delete this.slots[o];for(var o in this.constraints)this.constraints[o].returnToPool(),delete this.constraints[o];for(var o in this.skins)this.skins[o].returnToPool(),delete this.skins[o];for(var o in this.animations)this.animations[o].returnToPool(),delete this.animations[o];null!==this.canvas&&this.canvas.returnToPool(),null!==this.userData&&this.userData.returnToPool(),this.type=0,this.frameRate=0,this.cacheFrameRate=0,this.scale=1,this.name="",this.aabb.clear(),this.animationNames.length=0,this.sortedBones.length=0,this.sortedSlots.length=0,this.defaultActions.length=0,this.actions.length=0,this.defaultSkin=null,this.defaultAnimation=null,this.canvas=null,this.userData=null,this.parent=null},t.prototype.sortBones=function(){var t=this.sortedBones.length;if(!(t<=0)){var n=this.sortedBones.concat(),e=0,s=0;for(this.sortedBones.length=0;s<t;){var o=n[e++];if(t<=e&&(e=0),!(0<=this.sortedBones.indexOf(o))){var a=!1;for(var r in this.constraints){var i=this.constraints[r];if(i.root===o&&this.sortedBones.indexOf(i.target)<0){a=!0;break}}a||null!==o.parent&&this.sortedBones.indexOf(o.parent)<0||(this.sortedBones.push(o),s++)}}}},t.prototype.cacheFrames=function(t){if(!(0<this.cacheFrameRate))for(var n in this.cacheFrameRate=t,this.animations)this.animations[n].cacheFrames(this.cacheFrameRate)},t.prototype.setCacheFrame=function(t,n){var e=this.parent.cachedFrames,s=e.length;return e.length+=10,e[s]=t.a,e[s+1]=t.b,e[s+2]=t.c,e[s+3]=t.d,e[s+4]=t.tx,e[s+5]=t.ty,e[s+6]=n.rotation,e[s+7]=n.skew,e[s+8]=n.scaleX,e[s+9]=n.scaleY,s},t.prototype.getCacheFrame=function(t,n,e){var s=this.parent.cachedFrames;t.a=s[e],t.b=s[e+1],t.c=s[e+2],t.d=s[e+3],t.tx=s[e+4],t.ty=s[e+5],n.rotation=s[e+6],n.skew=s[e+7],n.scaleX=s[e+8],n.scaleY=s[e+9],n.x=t.tx,n.y=t.ty},t.prototype.addBone=function(t){t.name in this.bones?console.warn("Same bone: "+t.name):(this.bones[t.name]=t,this.sortedBones.push(t))},t.prototype.addSlot=function(t){t.name in this.slots?console.warn("Same slot: "+t.name):(this.slots[t.name]=t,this.sortedSlots.push(t))},t.prototype.addConstraint=function(t){t.name in this.constraints?console.warn("Same constraint: "+t.name):this.constraints[t.name]=t},t.prototype.addSkin=function(t){t.name in this.skins?console.warn("Same skin: "+t.name):((t.parent=this).skins[t.name]=t,null===this.defaultSkin&&(this.defaultSkin=t),"default"===t.name&&(this.defaultSkin=t))},t.prototype.addAnimation=function(t){t.name in this.animations?console.warn("Same animation: "+t.name):((t.parent=this).animations[t.name]=t,this.animationNames.push(t.name),null===this.defaultAnimation&&(this.defaultAnimation=t))},t.prototype.addAction=function(t,n){n?this.defaultActions.push(t):this.actions.push(t)},t.prototype.getBone=function(t){return t in this.bones?this.bones[t]:null},t.prototype.getSlot=function(t){return t in this.slots?this.slots[t]:null},t.prototype.getConstraint=function(t){return t in this.constraints?this.constraints[t]:null},t.prototype.getSkin=function(t){return t in this.skins?this.skins[t]:null},t.prototype.getMesh=function(t,n,e){var s=this.getSkin(t);return null===s?null:s.getDisplay(n,e)},t.prototype.getAnimation=function(t){return t in this.animations?this.animations[t]:null},t}(BaseObject_1.BaseObject);exports.ArmatureData=ArmatureData;var BoneData=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.transform=new Transform_1.Transform,t.userData=null,t}return __extends(t,n),t.toString=function(){return"[class dragonBones.BoneData]"},t.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.inheritTranslation=!1,this.inheritRotation=!1,this.inheritScale=!1,this.inheritReflection=!1,this.type=0,this.length=0,this.alpha=1,this.name="",this.transform.identity(),this.userData=null,this.parent=null},t}(BaseObject_1.BaseObject),SurfaceData=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.geometry=new DisplayData_1.GeometryData,t}return __extends(t,n),t.toString=function(){return"[class dragonBones.SurfaceData]"},t.prototype._onClear=function(){n.prototype._onClear.call(this),this.type=1,this.segmentX=0,this.segmentY=0,this.geometry.clear()},t}(exports.BoneData=BoneData);exports.SurfaceData=SurfaceData;var SlotData=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.color=null,t.userData=null,t}return __extends(t,n),t.createColor=function(){return new ColorTransform_1.ColorTransform},t.toString=function(){return"[class dragonBones.SlotData]"},t.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.blendMode=0,this.displayIndex=0,this.zOrder=0,this.zIndex=0,this.alpha=1,this.name="",this.color=null,this.userData=null,this.parent=null},t.DEFAULT_COLOR=new ColorTransform_1.ColorTransform,t}(BaseObject_1.BaseObject);exports.SlotData=SlotData;