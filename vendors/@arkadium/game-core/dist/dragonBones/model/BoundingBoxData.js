"use strict";var __extends=this&&this.__extends||function(){var o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)};return function(t,n){function e(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}();Object.defineProperty(exports,"__esModule",{value:!0});var BaseObject_1=require("../core/BaseObject"),BoundingBoxData=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype._onClear=function(){this.color=0,this.width=0,this.height=0},n}(BaseObject_1.BaseObject),RectangleBoundingBoxData=function(t){function _(){return null!==t&&t.apply(this,arguments)||this}return __extends(_,t),_.toString=function(){return"[class dragonBones.RectangleBoundingBoxData]"},_._computeOutCode=function(t,n,e,o,i,l){var r=0;return t<e?r|=1:i<t&&(r|=2),n<o?r|=4:l<n&&(r|=8),r},_.rectangleIntersectsSegment=function(t,n,e,o,i,l,r,u,a,s,h){void 0===a&&(a=null),void 0===s&&(s=null),void 0===h&&(h=null);var c=i<t&&t<r&&l<n&&n<u,p=i<e&&e<r&&l<o&&o<u;if(c&&p)return-1;for(var y=0,x=_._computeOutCode(t,n,i,l,r,u),d=_._computeOutCode(e,o,i,l,r,u);;){if(0==(x|d)){y=2;break}if(0!=(x&d))break;var g=0,v=0,f=0,B=0!==x?x:d;0!=(4&B)?(g=t+(e-t)*(l-n)/(o-n),v=l,null!==h&&(f=.5*-Math.PI)):0!=(8&B)?(g=t+(e-t)*(u-n)/(o-n),v=u,null!==h&&(f=.5*Math.PI)):0!=(2&B)?(v=n+(o-n)*(r-t)/(e-t),g=r,null!==h&&(f=0)):0!=(1&B)&&(v=n+(o-n)*(i-t)/(e-t),g=i,null!==h&&(f=Math.PI)),B===x?(x=_._computeOutCode(t=g,n=v,i,l,r,u),null!==h&&(h.x=f)):(d=_._computeOutCode(e=g,o=v,i,l,r,u),null!==h&&(h.y=f))}return y&&(c?(y=2,null!==a&&(a.x=e,a.y=o),null!==s&&(s.x=e,s.y=e),null!==h&&(h.x=h.y+Math.PI)):p?(y=1,null!==a&&(a.x=t,a.y=n),null!==s&&(s.x=t,s.y=n),null!==h&&(h.y=h.x+Math.PI)):(y=3,null!==a&&(a.x=t,a.y=n),null!==s&&(s.x=e,s.y=o))),y},_.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=0},_.prototype.containsPoint=function(t,n){var e=.5*this.width;if(-e<=t&&t<=e){var o=.5*this.height;if(-o<=n&&n<=o)return!0}return!1},_.prototype.intersectsSegment=function(t,n,e,o,i,l,r){void 0===i&&(i=null),void 0===l&&(l=null),void 0===r&&(r=null);var u=.5*this.width,a=.5*this.height;return _.rectangleIntersectsSegment(t,n,e,o,-u,-a,u,a,i,l,r)},_}(exports.BoundingBoxData=BoundingBoxData);exports.RectangleBoundingBoxData=RectangleBoundingBoxData;var EllipseBoundingBoxData=function(t){function u(){return null!==t&&t.apply(this,arguments)||this}return __extends(u,t),u.toString=function(){return"[class dragonBones.EllipseData]"},u.ellipseIntersectsSegment=function(t,n,e,o,i,l,r,u,a,s,h){void 0===a&&(a=null),void 0===s&&(s=null),void 0===h&&(h=null);var c=r/u,p=c*c,y=e-t,x=(o*=c)-(n*=c),d=Math.sqrt(y*y+x*x),g=y/d,v=x/d,f=(i-t)*g+(l-n)*v,B=r*r,_=B-(t*t+n*n)+f*f,M=0;if(0<=_){var P=Math.sqrt(_),I=f-P,D=f+P,m=I<0?-1:I<=d?0:1,O=D<0?-1:D<=d?0:1,S=m*O;if(S<0)return-1;0===S&&(-1===m?(M=2,e=t+D*g,o=(n+D*v)/c,null!==a&&(a.x=e,a.y=o),null!==s&&(s.x=e,s.y=o),null!==h&&(h.x=Math.atan2(o/B*p,e/B),h.y=h.x+Math.PI)):1===O?(M=1,t+=I*g,n=(n+I*v)/c,null!==a&&(a.x=t,a.y=n),null!==s&&(s.x=t,s.y=n),null!==h&&(h.x=Math.atan2(n/B*p,t/B),h.y=h.x+Math.PI)):(M=3,null!==a&&(a.x=t+I*g,a.y=(n+I*v)/c,null!==h&&(h.x=Math.atan2(a.y/B*p,a.x/B))),null!==s&&(s.x=t+D*g,s.y=(n+D*v)/c,null!==h&&(h.y=Math.atan2(s.y/B*p,s.x/B)))))}return M},u.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=1},u.prototype.containsPoint=function(t,n){var e=.5*this.width;if(-e<=t&&t<=e){var o=.5*this.height;if(-o<=n&&n<=o)return n*=e/o,Math.sqrt(t*t+n*n)<=e}return!1},u.prototype.intersectsSegment=function(t,n,e,o,i,l,r){return void 0===i&&(i=null),void 0===l&&(l=null),void 0===r&&(r=null),u.ellipseIntersectsSegment(t,n,e,o,0,0,.5*this.width,.5*this.height,i,l,r)},u}(BoundingBoxData);exports.EllipseBoundingBoxData=EllipseBoundingBoxData;var PolygonBoundingBoxData=function(n){function a(){var t=null!==n&&n.apply(this,arguments)||this;return t.vertices=[],t}return __extends(a,n),a.toString=function(){return"[class dragonBones.PolygonBoundingBoxData]"},a.polygonIntersectsSegment=function(t,n,e,o,i,l,r,u){void 0===l&&(l=null),void 0===r&&(r=null),void 0===u&&(u=null),t===e&&(t=e+1e-6),n===o&&(n=o+1e-6);for(var a=i.length,s=t-e,h=n-o,c=t*o-n*e,p=0,y=i[a-2],x=i[a-1],d=0,g=0,v=0,f=0,B=0,_=0,M=0;M<a;M+=2){var P=i[M],I=i[M+1];y===P&&(y=P+1e-4),x===I&&(x=I+1e-4);var D=y-P,m=x-I,O=y*I-x*P,S=s*m-h*D,C=(c*D-s*O)/S;if((y<=C&&C<=P||P<=C&&C<=y)&&(0===s||t<=C&&C<=e||e<=C&&C<=t)){var b=(c*m-h*O)/S;if((x<=b&&b<=I||I<=b&&b<=x)&&(0===h||n<=b&&b<=o||o<=b&&b<=n)){if(null===r){B=v=C,_=f=b,p++,null!==u&&(u.x=Math.atan2(I-x,P-y)-.5*Math.PI,u.y=u.x);break}var w=C-t;w<0&&(w=-w),0===p?(g=d=w,B=v=C,_=f=b,null!==u&&(u.x=Math.atan2(I-x,P-y)-.5*Math.PI,u.y=u.x)):(w<d&&(d=w,v=C,f=b,null!==u&&(u.x=Math.atan2(I-x,P-y)-.5*Math.PI)),g<w&&(g=w,B=C,_=b,null!==u&&(u.y=Math.atan2(I-x,P-y)-.5*Math.PI))),p++}}y=P,x=I}return 1===p?(null!==l&&(l.x=v,l.y=f),null!==r&&(r.x=v,r.y=f),null!==u&&(u.y=u.x+Math.PI)):1<p&&(p++,null!==l&&(l.x=v,l.y=f),null!==r&&(r.x=B,r.y=_)),p},a.prototype._onClear=function(){n.prototype._onClear.call(this),this.type=2,this.x=0,this.y=0,this.vertices.length=0},a.prototype.containsPoint=function(t,n){var e=!1;if(t>=this.x&&t<=this.width&&n>=this.y&&n<=this.height)for(var o=0,i=this.vertices.length,l=i-2;o<i;o+=2){var r=this.vertices[l+1],u=this.vertices[o+1];if(u<n&&n<=r||r<n&&n<=u){var a=this.vertices[l],s=this.vertices[o];(n-u)*(a-s)/(r-u)+s<t&&(e=!e)}l=o}return e},a.prototype.intersectsSegment=function(t,n,e,o,i,l,r){void 0===i&&(i=null),void 0===l&&(l=null),void 0===r&&(r=null);var u=0;return 0!==RectangleBoundingBoxData.rectangleIntersectsSegment(t,n,e,o,this.x,this.y,this.x+this.width,this.y+this.height,null,null,null)&&(u=a.polygonIntersectsSegment(t,n,e,o,this.vertices,i,l,r)),u},a}(BoundingBoxData);exports.PolygonBoundingBoxData=PolygonBoundingBoxData;