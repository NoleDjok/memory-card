"use strict";
/*!@license
 * Copyright (c) Arkadium Inc - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Roodik Anton <roodika@arkadium.com>
 */var __awaiter=this&&this.__awaiter||function(e,a,s,c){return new(s||(s=Promise))(function(n,t){function r(e){try{o(c.next(e))}catch(e){t(e)}}function i(e){try{o(c.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(r,i)}o((c=c.apply(e,a||[])).next())})},__generator=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(exports,"__esModule",{value:!0});var Environment_1=require("../../Environment"),AnalyticProperty_1=require("../AnalyticProperty"),AnalyticProviderEnum_1=require("../Provider/AnalyticProviderEnum"),AppInsightsAnalytic_1=require("../Provider/AppInsightsAnalytic"),ConsoleAnalytic_1=require("../Provider/ConsoleAnalytic"),EmptyAnalytic_1=require("../Provider/EmptyAnalytic"),GoogleAnalytic_1=require("../Provider/GoogleAnalytic"),BaseAnalytic=function(){function e(e,t){this._analyticProviders=new Array;for(var n=0;n<e.providers.length;n++)this._analyticProviders.push(e.providers[n].provider);this._properties=new Array,this._dimensions=new Array,this._gameVersion=e.gameVersion;var r=this.getAbsoluteDomainUrl();r&&this.addDimension({ai:AnalyticProperty_1.AnalyticProperty.DOMAIN,ga:"",value:r}),e.arenaName&&this.addDimension({ai:AnalyticProperty_1.AnalyticProperty.TRAFFIC_SOURCE,ga:"dimension1",value:e.arenaName}),this._gameVersion&&this.addDimension({ai:AnalyticProperty_1.AnalyticProperty.GAME_VERSION,ga:"dimension2",value:this._gameVersion}),Environment_1.Environment.type&&this.addDimension({ai:AnalyticProperty_1.AnalyticProperty.DEVICE_TYPE,ga:"",value:Environment_1.EnvironmentTypeEnum[Environment_1.Environment.type]}),t.isActive&&this.addDimension({ai:AnalyticProperty_1.AnalyticProperty.AB_TEST_VERSION,ga:"dimension3",value:t.testGroup}),this.parseTracker(e.providers)}return e.prototype.parseTracker=function(e){if(this._tracker=new EmptyAnalytic_1.EmptyAnalytic,null!=e)for(var t=0;t<e.length;t++){var n=e[t];switch(n.provider){case AnalyticProviderEnum_1.AnalyticProviderEnum.GOOGLE:this._tracker=new GoogleAnalytic_1.GoogleAnalytics(n,this._tracker);break;case AnalyticProviderEnum_1.AnalyticProviderEnum.APP_INSIGHTS:this._tracker=new AppInsightsAnalytic_1.AppInsightsAnalytic(n,this._tracker);break;case AnalyticProviderEnum_1.AnalyticProviderEnum.CONSOLE:this._tracker=new ConsoleAnalytic_1.ConsoleAnalytic(this._tracker)}}},e.prototype.addProperty=function(e){this._properties.push(e)},e.prototype.addDimension=function(e){this._dimensions.push(e)},e.prototype.sendPageViewInternal=function(e){[].concat(this._properties);this._properties=new Array,this._tracker.sendPageView(e,this._properties,this._dimensions)},e.prototype.sendEventInternal=function(n,r){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return t=[].concat(this._properties),this._properties=new Array,[2,this._tracker.sendEvent(n,r,t,this._dimensions)]})})},e.prototype.getAbsoluteDomainUrl=function(){return window&&"location"in window&&"protocol"in window.location&&"host"in window.location?window.location.protocol+"//"+window.location.host:null},e}();exports.BaseAnalytic=BaseAnalytic;