"use strict";
/*!@license
 * Copyright (c) Arkadium Inc - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Roodik Anton <roodika@arkadium.com>
 */var __extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(e,a,c,l){return new(c||(c=Promise))(function(n,t){function r(e){try{i(l.next(e))}catch(e){t(e)}}function o(e){try{i(l.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?n(e.value):(t=e.value,t instanceof c?t:new c(function(e){e(t)})).then(r,o)}i((l=l.apply(e,a||[])).next())})},__generator=this&&this.__generator||function(n,r){var o,i,a,e,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(a=2&t[0]?i.return:t[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,t[1])).done)return a;switch(i=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,i=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(a=0<(a=c.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){c.label=t[1];break}if(6===t[0]&&c.label<a[1]){c.label=a[1],a=t;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(t);break}a[2]&&c.ops.pop(),c.trys.pop();continue}t=r.call(n,c)}catch(e){t=[6,e],i=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(exports,"__esModule",{value:!0});var AnalyticDecorator_1=require("./AnalyticDecorator"),GoogleAnalytics=function(u){function e(e,t){var n=u.call(this,t)||this;n._initialized=!1;var r,o,i,a,c,l,s=e.appId;return r=window,o=document,i="script",a="_gameGATracker",r.GoogleAnalyticsObject=a,r[a]=r[a]||function(){(r[a].q=r[a].q||[]).push(arguments)},r[a].l=1*new Date,c=o.createElement(i),l=o.getElementsByTagName(i)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",l.parentNode.insertBefore(c,l),window._gameGATracker&&(window._gameGATracker("create",s,"auto"),n._initialized=!0),n}return __extends(e,u),e.prototype.sendPageView=function(e,t,n){this._initialized&&window._gameGATracker("send","pageview",e),u.prototype.sendPageView.call(this,e,t,n)},e.prototype.sendEvent=function(a,c,l,s){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(e){return this._initialized?[2,new Promise(function(e,t){var n=!1,r=setTimeout(function(){e(!(n=!0))},1e3),o={eventCategory:a,eventAction:c,eventLabel:i.parseProperties(l),eventValue:0,hitCallback:function(){clearTimeout(r),n||e(!0)},hitCallbackFail:function(){clearTimeout(r),n||t(!1)}};Object.assign(o,i.parseDimensions(s)),window._gameGATracker("send","event",o)})]:[2,u.prototype.sendEvent.call(this,a,c,l,s)]})})},e.prototype.parseProperties=function(e){for(var t="",n=0;n<e.length;n++){var r=e[n];t+=""!=t?"|"+r.value:r.value}return t},e.prototype.parseDimensions=function(e){for(var t={},n=0;n<e.length;n++){var r=e[n];r.ga&&(t[r.ga]=r.value)}return t},e}(AnalyticDecorator_1.AnalyticDecorator);exports.GoogleAnalytics=GoogleAnalytics;