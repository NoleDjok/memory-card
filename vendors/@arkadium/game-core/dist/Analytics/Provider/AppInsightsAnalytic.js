"use strict";
/*!@license
 * Copyright (c) Arkadium Inc - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Roodik Anton <roodika@arkadium.com>
 */var __extends=this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(e,o,c,s){return new(c||(c=Promise))(function(r,t){function n(e){try{a(s.next(e))}catch(e){t(e)}}function i(e){try{a(s.throw(e))}catch(e){t(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof c?t:new c(function(e){e(t)})).then(n,i)}a((s=s.apply(e,o||[])).next())})},__generator=this&&this.__generator||function(r,n){var i,a,o,e,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,a&&(o=2&t[0]?a.return:t[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,t[1])).done)return o;switch(a=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,a=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(o=0<(o=c.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){c.label=t[1];break}if(6===t[0]&&c.label<o[1]){c.label=o[1],o=t;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(t);break}o[2]&&c.ops.pop(),c.trys.pop();continue}t=n.call(r,c)}catch(e){t=[6,e],a=0}finally{i=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(exports,"__esModule",{value:!0});var AnalyticProperty_1=require("../AnalyticProperty"),AnalyticDecorator_1=require("./AnalyticDecorator"),applicationinsights_web_1=require("@microsoft/applicationinsights-web"),AppInsightsAnalytic=function(o){function e(e,t){var r=o.call(this,t)||this,n=e.providerConfig||r.getDefaultConfig(e.appId);return r._aiTracker=new applicationinsights_web_1.ApplicationInsights(n),r._aiTracker.loadAppInsights(),r}return __extends(e,o),e.prototype.getDefaultConfig=function(e){return{config:{instrumentationKey:e,maxBatchInterval:0,overridePageViewDuration:!0,enableSessionStorageBuffer:!1,disableAjaxTracking:!0,disableExceptionTracking:!0,disableCorrelationHeaders:!0,disableDataLossAnalysis:!0,namePrefix:e+"_GameCore_AppInsights"}}},e.prototype.sendPageView=function(e,t,r){if(this._aiTracker){var n=this.combinePageViewParameters(t,r);this._aiTracker.trackPageView({name:e,properties:n}),this._aiTracker.flush()}o.prototype.sendPageView.call(this,e,t,r)},e.prototype.sendEvent=function(r,n,i,a){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return this._aiTracker&&(t=this.combineEventParameters(n,i,a),this._aiTracker.trackEvent({name:r,properties:t}),this._aiTracker.flush()),[2,o.prototype.sendEvent.call(this,r,n,i,a)]})})},e.prototype.combinePageViewParameters=function(e,t){for(var r={},n=0;n<e.length;n++){r[(i=e[n]).key]=i.value}for(n=0;n<t.length;n++){var i;(i=t[n]).ai&&(r[i.ai]=i.value)}return r},e.prototype.combineEventParameters=function(e,t,r){var n={};n[AnalyticProperty_1.AnalyticProperty.ACTION]=e;for(var i=0;i<t.length;i++){n[(a=t[i]).key]=a.value}for(i=0;i<r.length;i++){var a;(a=r[i]).ai&&(n[a.ai]=a.value)}return n},e}(AnalyticDecorator_1.AnalyticDecorator);exports.AppInsightsAnalytic=AppInsightsAnalytic;