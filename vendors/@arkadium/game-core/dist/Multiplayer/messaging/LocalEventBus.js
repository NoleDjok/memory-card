"use strict";
/*!@license
 * Copyright (c) Arkadium Inc - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Denis Gusarov <denis.gusarov@arkadium.com>
 */var __decorate=this&&this.__decorate||function(t,e,n,r){var o,i=arguments.length,s=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;0<=a;a--)(o=t[a])&&(s=(i<3?o(s):3<i?o(e,n,s):o(e,n))||s);return 3<i&&s&&Object.defineProperty(e,n,s),s},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},__awaiter=this&&this.__awaiter||function(t,s,a,c){return new(a||(a=Promise))(function(n,e){function r(t){try{i(c.next(t))}catch(t){e(t)}}function o(t){try{i(c.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?n(t.value):(e=t.value,e instanceof a?e:new a(function(t){t(e)})).then(r,o)}i((c=c.apply(t,s||[])).next())})},__generator=this&&this.__generator||function(n,r){var o,i,s,t,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(s=2&e[0]?i.return:e[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,e[1])).done)return s;switch(i=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,i=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(n,a)}catch(t){e=[6,t],i=0}finally{o=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};Object.defineProperty(exports,"__esModule",{value:!0});var __1=require("../.."),LocalEventBus=function(){function t(){this.subscriptions=new Map}return t.prototype.getHandlers=function(t){return this.getSubscriptions(t).map(function(t){return t.asyncHandler})},t.prototype.getSubscriptions=function(t){return this.subscriptions.has(t)||this.subscriptions.set(t,[]),this.subscriptions.get(t)||[]},t.prototype.dispose=function(){this.subscriptions.forEach(function(t,e,n){t.length=0}),this.subscriptions.clear()},t.prototype.publishAsync=function(o){return __awaiter(this,void 0,void 0,function(){var e,n,r;return __generator(this,function(t){switch(t.label){case 0:e=this.getSubscriptions(o.id),n=0,r=e,t.label=1;case 1:return n<r.length?[4,r[n].asyncHandler(o)]:[3,4];case 2:t.sent(),t.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},t.prototype.subscribe=function(t,e){this.getSubscriptions(t).push({key:t,asyncHandler:e})},t.prototype.unsubscribe=function(t,e){for(var n=this.getSubscriptions(t),r=-1,o=0;o<n.length;o++)if(n[o].asyncHandler==e){r=o;break}0<=r&&n.splice(r,1)},t=__decorate([__1.Singleton,__metadata("design:paramtypes",[])],t)}();exports.LocalEventBus=LocalEventBus;