"use strict";var __decorate=this&&this.__decorate||function(t,e,a,i){var r,s=arguments.length,n=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,a,i);else for(var o=t.length-1;0<=o;o--)(r=t[o])&&(n=(s<3?r(n):3<s?r(e,a,n):r(e,a))||n);return 3<s&&n&&Object.defineProperty(e,a,n),n},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var typescript_ioc_1=require("../IoC/typescript-ioc"),AbTestManager=function(){function t(){this.STORAGE_KEY="-ab-test-settings",this._isActive=!1}return t.prototype.initialize=function(t,e){this._data=t,this._storage=e;var a=this._storage.loadData(this.STORAGE_KEY);this._abTestData=a?JSON.parse(a):new AbTestData,this._data&&this._data.key&&""!=this._data.key&&this._data.experiment&&0!=this._data.experiment.length&&(this._abTestData&&this._abTestData.group&&!t.refresh?(this._internalTestGroup=this._abTestData.group,this._isActive=!0):this.generateGroup(this._data))},t.prototype.generateGroup=function(t){t.experiment.sort(function(t,e){return t.probability<e.probability?-1:1});for(var e=Math.random(),a=t.experiment[0].probability,i=0;i<t.experiment.length;i++){if(e<=a){this._internalTestGroup=t.experiment[i].key,this._abTestData.group=this._internalTestGroup,this._storage.saveData(this.STORAGE_KEY,JSON.stringify(this._abTestData)),this._isActive=!0;break}a+=t.experiment[i].probability}},Object.defineProperty(t.prototype,"isActive",{get:function(){return this._isActive},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"testGroup",{get:function(){return this._internalTestGroup},enumerable:!0,configurable:!0}),t=__decorate([typescript_ioc_1.Singleton,__metadata("design:paramtypes",[])],t)}();exports.AbTestManager=AbTestManager;var AbTestData=function(){this.group=""};exports.AbTestData=AbTestData;