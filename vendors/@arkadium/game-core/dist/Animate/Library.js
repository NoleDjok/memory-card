"use strict";
/*!@license
 * Copyright (c) Arkadium Inc - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Denis Gusarov <denis.gusarov@arkadium.com>
 */Object.defineProperty(exports,"__esModule",{value:!0});var Bitmap_1=require("./items/Bitmap"),Shape_1=require("./items/Shape"),Sound_1=require("./items/Sound"),Graphic_1=require("./items/Graphic"),Stage_1=require("./items/Stage"),Text_1=require("./items/Text"),Container_1=require("./items/Container"),Timeline_1=require("./items/Timeline"),Library=function(){function e(n){var r=this;this.bitmaps=[],this.sounds=[],this.shapes=[],this.texts=[],this.timelines=[];var h=this._mapById={},m=this._mapByName={};this.stage=null,this.meta=n._meta,this.hasContainer=!1;var p=this;n.Bitmaps.forEach(function(e){var t=new Bitmap_1.Bitmap(p,e);r.bitmaps.push(t),h[t.assetId]=t}),n.Shapes.forEach(function(e,t){var i=new Shape_1.Shape(p,e);i.id=t,r.shapes.push(i),h[i.assetId]=i}),n.Sounds.forEach(function(e){var t=new Sound_1.Sound(p,e);r.sounds.push(t),h[t.assetId]=t}),n.Texts.forEach(function(e){var t=new Text_1.Text(p,e);r.texts.push(t),h[t.assetId]=t});var o=this;n.Timelines.forEach(function(e){var t;if(e.totalFrames<=1&&e.type!=Timeline_1.Timeline.STAGE?(o.hasContainer=!0,t=new Container_1.Container(p,e)):e.type==Timeline_1.Timeline.GRAPHIC?t=new Graphic_1.Graphic(p,e):e.type==Timeline_1.Timeline.STAGE?o.stage=t=new Stage_1.Stage(p,e,n._meta.framerate):t=new Timeline_1.Timeline(p,e),r.timelines.push(t),t.type==Timeline_1.Timeline.MOVIE_CLIP){for(var i=/_[0-9]+$/,a=t.name;m[a]||a==n._meta.stageName;){var s=void 0;i.test(a)?(a=a.split("_"),s=parseInt(a.pop())+1,a=a.join("_")):s=1,a+="_"+s.toString()}(m[a]=t).name=a}h[t.assetId]=t})}return e.prototype.createInstance=function(e,t){return this._mapById[e].create(t)},e.prototype.destroy=function(){this.shapes.length=0,this.shapes=null,this.bitmaps.length=0,this.bitmaps=null,this._mapById=null},e}();exports.Library=Library;