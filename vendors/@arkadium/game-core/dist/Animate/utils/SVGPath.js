"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Coord=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("NaN encountered: "+t+"/"+e);this.x=t,this.y=e},Point=function(){function t(t,e){this.main=new Coord(t,e),this.left=null,this.right=null,this.isplain=!0}return t.prototype.setLeft=function(t,e){this.isplain=!1,this.left=new Coord(t,e)},t.prototype.setRight=function(t,e){this.isplain=!1,this.right=new Coord(t,e)},t.prototype.isPlain=function(){return this.isplain},t.prototype.getPoint=function(){return this.main},t.prototype.getLeft=function(){return this.isplain?this.main:null==this.left?this.main:this.left},t.prototype.getRight=function(){return this.isplain?this.main:null==this.right?this.main:this.right},t}(),PointCurveShape=function(){function t(){this.points=[]}return t.prototype.current=function(){return this.points.slice(-1)[0]},t.prototype.addPoint=function(t,e){this.points.push(new Point(t,e))},t.prototype.setLeft=function(t,e){this.current().setLeft(t,e)},t.prototype.setRight=function(t,e){this.current().setRight(t,e)},t.prototype.toSVG=function(){for(var t=this.points,e=t[0].getPoint(),r=e.x,n=e.y,o="M"+r+(n<0?n:" "+n),i=1;i<t.length;i++){var s=t[i-1],a=t[i];if(a.isPlain()&&s.isPlain()){var p=a.getPoint().x,u=a.getPoint().y;o+="L"+p+(u<0?u:" "+u)}else{var h=s.getRight().x,l=s.getRight().y,c=a.getLeft().x,f=a.getLeft().y,y=a.getPoint().x,x=a.getPoint().y;o+="C"+h+(l<0?l:" "+l)+(c<0?c:" "+c)+(f<0?f:" "+f)+(y<0?y:" "+y)+(x<0?x:" "+x)}}return o},t}();exports.PointCurveShape=PointCurveShape;var Outline=function(){function t(){this.curveshapes=[],this.current=new PointCurveShape}return t.prototype.getShapes=function(){return this.curveshapes},t.prototype.getShape=function(t){return this.curveshapes[t]},t.prototype.toSVG=function(){var e="";return this.curveshapes.forEach(function(t){return e+=t.toSVG()}),e},t.prototype.startGroup=function(){this.curveshapes=[]},t.prototype.startShape=function(){this.current=new PointCurveShape},t.prototype.addPoint=function(t,e){this.current.addPoint(t,e),this.updateBounds(t,e,t,e)},t.prototype.updateBounds=function(t,e,r,n){this.bounds||(this.bounds={xMin:t,yMin:e,xMax:r,yMax:n}),t<this.bounds.xMin&&(this.bounds.xMin=t),r>this.bounds.xMax&&(this.bounds.xMax=r),e<this.bounds.yMin&&(this.bounds.yMin=e),n>this.bounds.yMax&&(this.bounds.yMax=n)},t.prototype.setLeftControl=function(t,e){this.current.setLeft(t,e)},t.prototype.setRightControl=function(t,e){this.current.setRight(t,e)},t.prototype.closeShape=function(){this.curveshapes.push(this.current),this.current=null},t.prototype.closeGroup=function(){this.curveshapes.push(this.current),this.current=null},t}();exports.Outline=Outline;var SVGParser=function(){function t(t){this.receiver=t}return t.prototype.getReceiver=function(){return this.receiver},t.prototype.parse=function(t,x,v){x=x||0,v=v||0;var d=(t=t.replace(/\s*([mlvhqczMLVHQCZ])\s*/g,"\n$1 ").replace(/,/g," ").replace(/-/g," -").replace(/ +/g," ")).split("\n"),g=x,F=v,M=this.receiver;M.startGroup();for(var e=function(t){var e=d[t].trim(),r=e.substring(0,1),n=1<e.length?e.substring(2).trim().split(" "):[];if("m"===r||"M"===r){if("m"===r?(g+=parseFloat(n[0]),F+=parseFloat(n[1])):"M"===r&&(g=parseFloat(n[0])+x,F=parseFloat(n[1])+v),t<d.length-1){var o=d[t+1].trim().substring(0,1);"m"!==o&&"M"!==o&&"z"!==o&&"Z"!==o&&(1<t&&M.closeShape(),M.startShape(),M.addPoint(g,F))}}else if("l"===r||"L"===r)for(var i=0;i<n.length;i+=2)"l"===r?(g+=parseFloat(n[i+0]),F+=parseFloat(n[i+1])):"L"===r&&(g=parseFloat(n[i+0])+x,F=parseFloat(n[i+1])+v),M.addPoint(g,F);else if("v"===r||"V"===r)n.forEach(function(t){"v"===r?F+=parseFloat(t):"V"===r&&(F=parseFloat(t)+v),M.addPoint(g,F)});else if("h"===r||"H"===r)n.forEach(function(t){"h"===r?g+=parseFloat(t):"H"===r&&(g=parseFloat(t)+v),M.addPoint(g,F)});else if("q"===r||"Q"===r)for(var s=0;s<n.length;s+=4){var a=0,p=0;"q"===r?(a=g+parseFloat(n[s]),p=F+parseFloat(n[s+1])):"Q"===r&&(a=parseFloat(n[s])+x,p=parseFloat(n[s+1])+v);var u=(F+p+p)/3;g==(y=(g+a+a)/3)&&F==u||M.setRightControl(y,u);var h=P.getQuadraticCurveBounds(g,F,parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]));M.updateBounds(h.xMin,h.yMin,h.xMax,h.yMax),"q"===r?(g+=parseFloat(n[s+2]),F+=parseFloat(n[s+3])):"Q"===r&&(g=parseFloat(n[s+2])+x,F=parseFloat(n[s+3])+v);var l=(g+a+a)/3,c=(F+p+p)/3;M.addPoint(g,F),g==l&&F==c||M.setLeftControl(l,c)}else if("c"===r||"C"===r)for(var f=0;f<n.length;f+=6){var y=0;u=0;"c"===r?(y=g+parseFloat(n[f]),u=F+parseFloat(n[f+1])):"C"===r&&(y=parseFloat(n[f])+x,u=parseFloat(n[f+1])+v),g==y&&F==u||M.setRightControl(y,u);l=0,c=0;"c"===r?(l=g+parseFloat(n[f+2]),c=F+parseFloat(n[f+3])):"C"===r&&(l=parseFloat(n[f+2])+x,c=parseFloat(n[f+3])+v),"c"===r?(g+=parseFloat(n[f+4]),F+=parseFloat(n[f+5])):"C"===r&&(g=parseFloat(n[f+4])+x,F=parseFloat(n[f+5])+v),M.addPoint(g,F),g==l&&F==c||M.setLeftControl(l,c)}else if("z"===r||"Z"===r)return M.closeGroup(),{value:void 0}},P=this,r=1;r<d.length;r++){var n=e(r);if("object"==typeof n)return n.value}M.closeGroup()},t.prototype.getQuadraticCurveBounds=function(t,e,r,n,o,i){function s(t,e){this.x=t,this.y=e}function a(t,e,r,n){if(n<=0||1<=n||isNaN(n))return!1;var o=new s(t.x+(e.x-t.x)*n,t.y+(e.y-t.y)*n),i=new s(e.x+(r.x-e.x)*n,e.y+(r.y-e.y)*n);return new s(o.x+(i.x-o.x)*n,o.y+(i.y-o.y)*n)}var p=new s(t,e),u=new s(r,n),h=new s(o,i),l=(p.x-u.x)/(p.x-2*u.x+h.x),c=(p.y-u.y)/(p.y-2*u.y+h.y),f=a(p,u,h,l),y=f?Math.min(p.x,h.x,f.x):Math.min(p.x,h.x),x=f?Math.max(p.x,h.x,f.x):Math.max(p.x,h.x),v=a(p,u,h,c);return{xMin:y,yMin:v?Math.min(p.y,h.y,v.y):Math.min(p.y,h.y),xMax:x,yMax:v?Math.max(p.y,h.y,v.y):Math.max(p.y,h.y)}},t}();exports.SVGParser=SVGParser;var SVGPath=function(){function t(){}return t.parse=function(t){var e=new Outline;return new SVGParser(e).parse(t),e},t}();exports.SVGPath=SVGPath;