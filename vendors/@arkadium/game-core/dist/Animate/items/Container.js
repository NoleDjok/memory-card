"use strict";
/*!@license
 * Copyright (c) Arkadium Inc - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Denis Gusarov <denis.gusarov@arkadium.com>
 */var __extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}();Object.defineProperty(exports,"__esModule",{value:!0});var LibraryItem_1=require("./LibraryItem"),SoundInstance_1=require("../instances/SoundInstance"),ContainerInstance_1=require("../instances/ContainerInstance"),MovieClipFactory_1=require("../factories/MovieClipFactory"),Container=function(r){function e(e,t){var n=r.call(this,e,t)||this;return n.instancesMap={},n.children=[],n.addChildren=[],n.getChildren(),n}return __extends(e,r),e.prototype.render=function(e){var t=new MovieClipFactory_1.MovieClipContainerFactory({},e,this.name);e[this.name]=t,this.getContents(t)},e.prototype.getChildren=function(){var r=this.library,i=this.instancesMap,a=this.children;this.frames.forEach(function(n){n.commands&&n.commands.forEach(function(e){var t=i[e.instanceId];t||(t=r.createInstance(e.assetId,e.instanceId),i[e.instanceId]=t),t.addToFrame(n.frame,e),t instanceof SoundInstance_1.SoundInstance||-1!=a.indexOf(t)||a.push(t)})})},e.prototype.getContents=function(e){this.renderChildren(e)},e.prototype.flattenDepthItems=function(e){var t=[];e.sort(function(e,t){return t.startFrame-e.startFrame});for(var n=0;n<e.length;n++){var r=e[n];if(t.push(r.instance),r.children.length){var i=this.flattenDepthItems(r.children);t.push.apply(t,i)}}return t},e.prototype.renderChildren=function(e){var t=this.children.length,n="";if(t){for(var r=[],i=this.children.slice(0),a={},s=0;s<t;s++){if(!(p=this.children[s]).placeAfter){i.splice(i.indexOf(p),1);var o={instance:p.id,startFrame:p.startFrame,placeAfter:0,children:[]};a[p.id]=o,r.push(o)}}for(;i.length;)for(s=0;s<i.length;s++){var c=a[(p=i[s]).placeAfter];if(c){i.splice(s,1);o={instance:p.id,startFrame:p.startFrame,placeAfter:p.placeAfter,children:[]};c.children.push(o),c.children.sort(this.sortByStartFrame),a[p.id]=o;break}}var h=this.flattenDepthItems(r);h.reverse();for(s=0;s<h.length;s++){var p;(p=this.instancesMap[h[s]]).renderable&&(n+=this.renderInstance(p,e))}}return n},e.prototype.renderInstance=function(e,t){this.addChildren.push(e.localName),e.render(t)},e.prototype.create=function(e){return new ContainerInstance_1.ContainerInstance(this,e)},e}(LibraryItem_1.LibraryItem);exports.Container=Container;