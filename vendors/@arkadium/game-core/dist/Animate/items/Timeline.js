"use strict";
/*!@license
 * Copyright (c) Arkadium Inc - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Denis Gusarov <denis.gusarov@arkadium.com>
 */var __extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(exports,"__esModule",{value:!0});var TimelineInstance_1=require("../instances/TimelineInstance"),MovieClipFactory_1=require("../factories/MovieClipFactory"),Container_1=require("./Container"),Timeline=function(r){function t(t,e){var n=r.call(this,t,e)||this;return n._isTimeline=!0,n}return __extends(t,r),t.prototype.render=function(t){var e={duration:this.totalFrames,labels:{}},n=this.getLabels();!!Object.keys(n).length&&(e.labels=n);var r=new MovieClipFactory_1.MovieClipFactory(e,t,this.name);t[this.name]=r,this.getContents(r)},t.prototype.getContents=function(t){r.prototype.getContents.call(this,t),this.getFrameScripts(t)},t.prototype.renderInstance=function(t,e){var n=this.totalFrames,r=t.getDuration(n),a=t.getFrames(),i="addTimedChild";return a||0!==t.startFrame||r!=n?e._frames.push({func:i,instance:t.localName,instanceId:t.id,startFrame:t.startFrame,duration:r,frames:a}):1<n?e._frames.push({func:i,instance:t.localName,instanceId:t.id}):this.addChildren.push(t.localName),t.render(e)},t.prototype.getFrameScripts=function(t){var n=this.library,r=[];if(this.frames.forEach(function(e){e.scripts&&r.push(e),e.commands&&e.commands.length&&e.commands.filter(function(t){return"SoundPlace"===t.type}).forEach(function(t){n.createInstance(t.assetId,t.instanceId);r.push({frame:e.frame,scripts:[]})})}),r.length)for(var e=0;e<r.length;e++)for(var a=r[e],i=a.scripts,o=0;o<i.length;o++){var s=i[o].replace(/\\n/g,"\n");t._scripts.push({script:s,frame:a.frame})}},t.prototype.getLabels=function(){var n={};return this.frames.forEach(function(e){e.labels&&e.labels.forEach(function(t){n[t]=e.frame})}),n},t.prototype.getSounds=function(){var a=this.library,i={};return this.frames.forEach(function(t){t.commands&&t.commands.filter(function(t){return"SoundPlace"===t.type}).forEach(function(t){var e=a.createInstance(t.assetId,t.instanceId).libraryItem,n=e.name,r=e.src;i[n]=r})}),i},t.prototype.create=function(t){return new TimelineInstance_1.TimelineInstance(this,t)},t.STAGE="stage",t.GRAPHIC="graphic",t.MOVIE_CLIP="movieclip",t}(Container_1.Container);exports.Timeline=Timeline;