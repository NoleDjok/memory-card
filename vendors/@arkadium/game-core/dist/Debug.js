"use strict";
/*!@license
 * Copyright (c) Arkadium Inc - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Denis Gusarov <denis.gusarov@arkadium.com>
 */var __decorate=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;0<=s;s--)(n=e[s])&&(a=(i<3?n(a):3<i?n(t,r,a):n(t,r))||a);return 3<i&&a&&Object.defineProperty(t,r,a),a},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var o=Array(e),n=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,n++)o[n]=i[a];return o};Object.defineProperty(exports,"__esModule",{value:!0});var Linq_1=require("./Linq/Linq"),SpriteEvents_1=require("./Base/SpriteEvents"),typescript_ioc_1=require("./IoC/typescript-ioc"),ResourcesLoader_1=require("./Base/Resources/ResourcesLoader"),LocalizationManager_1=require("./Base/Localization/LocalizationManager"),KeyboardManager_1=require("./Base/Keyboard/KeyboardManager"),Rndm_1=require("./Utils/Rndm"),StorageManager_1=require("./Base/Storage/StorageManager"),SoundManager_1=require("./Base/Sound/SoundManager"),DevicePixelRatio_1=require("./DevicePixelRatio"),GameResources_1=require("./GameResources"),PIXIRenderer_1=require("./PIXIRenderer"),ViewBaseEmptyLogger_1=require("./Base/ViewBaseEmptyLogger"),AutotestLogger=function(){function a(){this._current={viewName:null,messageType:null,message:null,index:0}}return a.addMessageToIgnoreList=function(e,t,r){a._ignoreMessageList.Add({viewName:e,messageType:t,message:r})},a.prototype.log=function(t,r,o){for(var e=[],n=3;n<arguments.length;n++)e[n-3]=arguments[n];if(a._logIndex++,!a._ignoreMessageList.Any(function(e){return!(e.viewName&&e.viewName!=t||e.messageType&&e.messageType!=r||e.message&&e.message!=o)})){var i="background: #222; color: #fff";"AnimationsEvent"==r?i="background: #222; color: #5f5":"ModelWatchEvent"==r?i="background: #222; color: #99f":"SpritesEvent"==r?i="background: #222; color: #FFD800":"LoadCompleted"==r?i="background: #222; color: #4CB6FF":"LoadSound"==r&&(i="background: #222; color: #ffaa21"),this._current.viewName==t&&this._current.messageType==r&&this._current.message==o?this._current.optionalParams=e:(this._current.viewName&&a._logIndex>this._current.index+1&&console.log(a._logIndex+" "+this._current.viewName+"->"+this._current.messageType+": ",this._current.message,this._current.optionalParams),this._current.viewName=t,this._current.messageType=r,this._current.message=o,this._current.index=a._logIndex,this._current.optionalParams=e,console.log("%c "+a._logIndex+" "+t+"->"+r+": ",i,o,e)),a._logList.Add({index:a._logIndex,viewName:t,messageType:r,message:o})}},a.prototype.warn=function(e,t,r,o){for(var n=[],i=4;i<arguments.length;i++)n[i-4]=arguments[i];console.warn(e,t+"->"+r+": ",o,n)},a.prototype.error=function(e,t,r){for(var o=[],n=3;n<arguments.length;n++)o[n-3]=arguments[n]},a._logIndex=0,a._logList=new Linq_1.List,a._ignoreMessageList=new Linq_1.List,a}();exports.AutotestLogger=AutotestLogger;var DebugEmptyLogger=function(){function e(){}return e.prototype.log=function(e,t,r){for(var o,n=[],i=3;i<arguments.length;i++)n[i-3]=arguments[i];(o=this._innerLogger).log.apply(o,__spreadArrays([e,t,r],n))},e.prototype.error=function(e,t,r){for(var o,n=[],i=3;i<arguments.length;i++)n[i-3]=arguments[i];(o=this._innerLogger).error.apply(o,__spreadArrays([e,t,r],n))},e.prototype.warn=function(e,t,r,o){for(var n=[],i=4;i<arguments.length;i++)n[i-4]=arguments[i];console.warn(e,t+"->"+r+": ",o,n)},e.prototype.setInnerLogger=function(e){this._innerLogger=e},e=__decorate([typescript_ioc_1.Singleton],e)}();exports.DebugEmptyLogger=DebugEmptyLogger;var Debug=function(){function e(){this.enabled=!1,this.ready=!1,this.container=typescript_ioc_1.Container}var o;return o=e,Object.defineProperty(e.prototype,"htmlElement",{get:function(){return this._htmlElement},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resourcesLoader",{get:function(){return typescript_ioc_1.Container.get(ResourcesLoader_1.ResourcesLoader)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"devicePixelRatio",{get:function(){return typescript_ioc_1.Container.get(DevicePixelRatio_1.DevicePixelRatio)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localizationManager",{get:function(){return typescript_ioc_1.Container.get(LocalizationManager_1.LocalizationManager)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resourcesRoot",{get:function(){return typescript_ioc_1.Container.get(GameResources_1.GameResources)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderer",{get:function(){return typescript_ioc_1.Container.get(PIXIRenderer_1.PIXIRenderer)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keyboardManager",{get:function(){return typescript_ioc_1.Container.get(KeyboardManager_1.KeyboardManager)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"random",{get:function(){return typescript_ioc_1.Container.get(Rndm_1.Random)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"storageManager",{get:function(){return typescript_ioc_1.Container.get(StorageManager_1.StorageManager)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"soundManager",{get:function(){return typescript_ioc_1.Container.get(SoundManager_1.SoundManager)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"logger",{get:function(){return typescript_ioc_1.Container.get(ViewBaseEmptyLogger_1.ViewBaseEmptyLogger)},enumerable:!0,configurable:!0}),e.addMessageToIgnoreList=function(e,t,r){AutotestLogger.addMessageToIgnoreList(e,t,r)},e.prototype.init=function(e,t){this._gameRun=t.gameRun;var r=function(e,t){t||(t=location.href),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null==r?null:r[1]}("ark-game-debug");r&&typescript_ioc_1.Container.bind(ViewBaseEmptyLogger_1.ViewBaseEmptyLogger).to(AutotestLogger).scope(typescript_ioc_1.Scope.Singleton),r||e.__TestRec__App__?(this._htmlElement=t.htmlElement,(e.__Game__Debug__=o).container=typescript_ioc_1.Container,o.instancesList.push(this),e.__TestRec__App__&&e.__TestRec__App__.setup(this),this.enabled=!0):this.play(),r&&this.play()},e.prototype.bindStorageManager=function(e){typescript_ioc_1.Container.bind(StorageManager_1.StorageManager).to(e).scope(typescript_ioc_1.Scope.Singleton)},e.prototype.setLogger=function(e){try{typescript_ioc_1.Container.bind(ViewBaseEmptyLogger_1.ViewBaseEmptyLogger).to(DebugEmptyLogger).scope(typescript_ioc_1.Scope.Singleton),typescript_ioc_1.Container.get(ViewBaseEmptyLogger_1.ViewBaseEmptyLogger).setInnerLogger(e)}catch(e){}},e.prototype.blockSpritesEvents=function(e){SpriteEvents_1.SpritesEventItem.blockSpritesEvents=e},e.prototype.play=function(){this._gameRun?(this.$root=this._gameRun(),this._gameRun=null):this.$root.play()},e.prototype.pause=function(){this.$root.pause()},e.instancesList=[],e.pages=[],e=o=__decorate([typescript_ioc_1.Singleton,__metadata("design:paramtypes",[])],e)}();exports.Debug=Debug;